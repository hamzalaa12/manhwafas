# ๐ ุฏููู ูุธุงู ุงูููุงููุฉ ุนูู ุงููุญุชูู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุงูููุงููุฉ ููุนูู ูุน ุงููุธุงู ุงูุชููุงุฆู ูุฅุถุงูุฉ ุงููุงูุฌุง. ุงููุธุงู ูุถูู ุงููุญุชูู ุชููุงุฆูุงู ูููู ูุชุทูุจ ููุงููุฉ ุงูุฅุฏุงุฑุฉ ูุจู ุฅุธูุงุฑู ูููุณุชุฎุฏููู.

## ๐ ุณูุฑ ุงูุนูู

### 1. ุงูุฅุถุงูุฉ ุงูุชููุงุฆูุฉ
```
๐ฅ ุงููุธุงู ูุฌูุจ ูุญุชูู ุฌุฏูุฏ ูู ุงููุตุงุฏุฑ
    โฌ๏ธ
๐ ูุญุต ุงูุชูุฑุงุฑ ูุชุฌูุจ ุงููุญุชูู ุงูููุฑุฑ
    โฌ๏ธ 
๐ ุฅุถุงูุฉ ุงููุญุชูู ูุน ุญุงูุฉ "pending"
    โฌ๏ธ
๐ ุฅุดุนุงุฑ ุงููุฏุฑุงุก ุจูุฌูุฏ ูุญุชูู ูููุฑุงุฌุนุฉ
    โฌ๏ธ
๐จโ๐ผ ูุฑุงุฌุนุฉ ุงูุฅุฏุงุฑุฉ ูุงูููุงููุฉ/ุงูุฑูุถ
    โฌ๏ธ
โ ูุดุฑ ุงููุญุชูู ุงููุนุชูุฏ ูููุณุชุฎุฏููู
```

### 2. ุญุงูุงุช ุงูููุงููุฉ

| ุงูุญุงูุฉ | ุงููุตู | ูุฑุฆู ูููุณุชุฎุฏููู |
|--------|-------|------------------|
| `pending` | ูู ุงูุชุธุงุฑ ุงููุฑุงุฌุนุฉ | โ ูุง |
| `approved` | ุชู ุงุนุชูุงุฏู | โ ูุนู |
| `rejected` | ุชู ุฑูุถู | โ ูุง |

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฃุนูุฏุฉ ุงูููุงููุฉ ุงูุฌุฏูุฏุฉ

```sql
-- ูููุงูุฌุง ูุงููุตูู
approval_status approval_status DEFAULT 'approved'  -- ุญุงูุฉ ุงูููุงููุฉ
reviewed_by TEXT                                    -- ูุนุฑู ุงููุฑุงุฌุน
reviewed_at TIMESTAMPTZ                            -- ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ  
review_notes TEXT                                   -- ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ
```

### ุฌุฏูู ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ

```sql
content_review_queue (
  id UUID PRIMARY KEY,
  content_type VARCHAR(20),      -- 'manga' ุฃู 'chapter'
  content_id TEXT,               -- ูุนุฑู ุงููุญุชูู
  manga_id TEXT,                 -- ูููุตููุ ุฑุจุท ุจุงููุงูุฌุง
  title TEXT,                    -- ุนููุงู ุงููุญุชูู
  description TEXT,              -- ูุตู ุงููุญุชูู
  priority INTEGER DEFAULT 0,    -- ุฃููููุฉ ุงููุฑุงุฌุนุฉ
  auto_added_by TEXT,           -- ูุตุฏุฑ ุงูุฅุถุงูุฉ
  status approval_status,        -- ุญุงูุฉ ุงููุฑุงุฌุน๏ฟฝ๏ฟฝ
  submitted_at TIMESTAMPTZ,      -- ุชุงุฑูุฎ ุงูุฅุฑุณุงู
  reviewed_by TEXT,             -- ุงููุฑุงุฌุน
  reviewed_at TIMESTAMPTZ,      -- ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ
  review_notes TEXT,            -- ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ
  reviewer_action TEXT          -- ุฅุฌุฑุงุก ุงููุฑุงุฌุน
)
```

## ๐๏ธ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ

### ุฅุถุงูุฉ ูููุฑุงุฌุนุฉ
```sql
SELECT add_to_review_queue(
  'manga',                    -- ููุน ุงููุญุชูู
  'manga-id-123',            -- ูุนุฑู ุงููุญุชูู
  NULL,                      -- ูุนุฑู ุงููุงูุฌุง (ูููุตูู)
  'ุนููุงู ุงููุงูุฌุง',           -- ุงูุนููุงู
  'ูุตู ุงููุงูุฌุง',            -- ุงููุตู
  1,                         -- ุงูุฃููููุฉ
  'auto-system'              -- ูุตุฏุฑ ุงูุฅุถุงูุฉ
);
```

### ุงูููุงููุฉ ุนูู ุงููุญุชูู
```sql
SELECT approve_content(
  'queue-id-uuid',           -- ูุนุฑู ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ
  'admin-user-id',          -- ูุนุฑู ุงููุฑุงุฌุน
  'ููุงุญุธุงุช ุงูููุงููุฉ'        -- ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ
);
```

### ุฑูุถ ุงููุญุชูู
```sql
SELECT reject_content(
  'queue-id-uuid',           -- ูุนุฑู ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ  
  'admin-user-id',          -- ูุนุฑู ุงููุฑุงุฌุน
  'ุณุจุจ ุง๏ฟฝ๏ฟฝุฑูุถ'               -- ููุงุญุธุงุช ูุทููุจุฉ
);
```

### ุฌูุจ ุงูุฅุญุตุงุฆูุงุช
```sql
SELECT * FROM get_review_queue_stats();
-- ุฅุฑุฌุงุน: pending_manga, pending_chapters, total_pending, 
--        approved_today, rejected_today, oldest_pending_days
```

## ๐๏ธ ูุงุฌูุฉ ุงููุฑุงุฌุนุฉ

### ุงููุตูู ูููุงุฌูุฉ
- **ููุญุฉ ุงูุฅุฏุงุฑุฉ** โ ุฒุฑ "ูุฑุงุฌุนุฉ ุงููุญุชูู" (ุจุฑุชูุงูู)
- **ุงูุฑุงุจุท ุงููุจุงุดุฑ:** `/admin/review-queue`
- **ุงูุตูุงุญูุงุช:** admin, owner, site_admin ููุท

### ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

#### 1. ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ
```typescript
- ุฅุฌูุงูู ุงููุนูู: XX
- ูุงูุฌุง ูุนููุฉ: XX  
- ูุตูู ูุนููุฉ: XX
- ุฃูุฏู ุนูุตุฑ ูุนูู: XX ููู
```

#### 2. ููุงุชุฑ ุงููุญุชูู
- **ุงููู:** ุฌููุน ุงูุนูุงุตุฑ ุงููุนููุฉ
- **ูุงูุฌุง:** ุงููุงูุฌุง ุงููุนููุฉ ููุท
- **ูุตูู:** ุงููุตูู ุงููุนููุฉ ููุท

#### 3. ูุนูููุงุช ุงูุนูุตุฑ
- ุงูุนููุงู ูุงููุตู
- ููุน ุงููุญุชูู (ูุงูุฌุง/ูุตู)
- ุงูุฃููููุฉ (ุนุงููุฉ/ุนุงุฏูุฉ)
- ุชุงุฑูุฎ ุงูุฅุถุงูุฉ
- ุงููุตุฏุฑ
- ุงูุชุตูููุงุช (ูููุงูุฌุง)
- ุฑูู ุงููุตู (ูููุตูู)

#### 4. ุฅุฌุฑุงุกุงุช ุงููุฑุงุฌุนุฉ
- **ุนุฑุถ:** ูุชุญ ุงููุญุชูู ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ
- **ููุงููุฉ:** ุงุนุชูุงุฏ ุงููุญุชูู ููุดุฑู
- **ุฑูุถ:** ุฑูุถ ุงููุญุชูู ูุฅุฎูุงุคู

## ๐ฑ ุงูุฅุดุนุงุฑุงุช

### ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
```typescript
// ุนูุฏ ุฅุถุงูุฉ ูุญุชูู ูููุฑุงุฌุนุฉ
{
  type: 'content_review',
  title: 'ูุญุชูู ุฌุฏูุฏ ูููุฑุงุฌุนุฉ',
  message: 'ูุงูุฌุง ุฌุฏูุฏุฉ ุชุญุชุงุฌ ูููุฑุงุฌุนุฉ: ุนููุงู ุงููุงูุฌุง',
  data: {
    queue_id: 'uuid',
    content_type: 'manga',
    content_id: 'manga-id',
    title: 'ุนููุงู ุงููุงูุฌุง'
  }
}
```

### ููููุงุช ุงูุฅุดุนุงุฑุงุช
- **ReviewNotifications:** ุฅุดุนุงุฑ ุซุงุจุช ูู ุงูุฒุงููุฉ
- **ReviewNotificationIcon:** ุฃููููุฉ ูุน ุนุฏุงุฏ ูู ุงูุดุฑูุท ุงูุนููู

## ๐ง ุงูุชูุงูู ูุน ุงููุธุงู ุงูุชููุงุฆู

### ุชุญุฏูุซ ุฎุฏูุฉ ุงููุงูุฌุง ุงูุชููุงุฆูุฉ

```typescript
// autoMangaServiceWithApproval.ts
class AutoMangaServiceWithApproval {
  
  // ุฅุถุงูุฉ ูุงูุฌุง ูููุฑุงุฌุนุฉ
  private async addNewMangaForApproval(mangaData: MangaData) {
    const { data: manga } = await supabase
      .from('manga')
      .insert({
        ...mangaData,
        auto_added: true,           // ูุถุงูุฉ ุชููุงุฆูุงู
        approval_status: 'pending', // ูู ุงูุชุธ๏ฟฝ๏ฟฝุฑ ุงููุฑุงุฌุนุฉ
        created_by: 'auto-system'
      });
    
    return manga.id;
  }
  
  // ูุชุงุฆุฌ ุงููุฒุงููุฉ ุชุดูู ุงูุนูุงุตุฑ ุงููุนููุฉ
  interface SyncResult {
    newManga: number;
    newChapters: number;
    duplicatesSkipped: number;
    pendingReview: number;  // ๐ ุงูุนูุงุตุฑ ุงููุนููุฉ
    errors: string[];
  }
}
```

### Triggers ุงูุชููุงุฆูุฉ

```sql
-- ุนูุฏ ุฅุฏุฑุงุฌ ูุงูุฌุง ุฌุฏูุฏุฉ
CREATE TRIGGER manga_auto_review 
  BEFORE INSERT ON manga 
  FOR EACH ROW 
  EXECUTE FUNCTION trigger_add_manga_to_review();

-- ุนูุฏ ุฅุฏุฑุงุฌ ูุตู ุฌุฏูุฏ  
CREATE TRIGGER chapter_auto_review 
  BEFORE INSERT ON chapters 
  FOR EACH ROW 
  EXECUTE FUNCTION trigger_add_chapter_to_review();
```

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### Row Level Security (RLS)

```sql
-- ุงููุฏุฑุงุก ููุท ูุฑูู ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ
CREATE POLICY "Admins can manage review queue" ON content_review_queue
  FOR ALL USING (
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE profiles.user_id = auth.uid() 
      AND profiles.role IN ('admin', 'owner', 'site_admin')
    )
  );

-- ุงููุณุชุฎุฏููู ูุฑูู ุงููุญุชูู ุงููุนุชูุฏ ููุท
CREATE POLICY "Anyone can view approved manga" ON manga
  FOR SELECT USING (
    approval_status = 'approved' OR 
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE profiles.user_id = auth.uid() 
      AND profiles.role IN ('admin', 'owner', 'site_admin')
    )
  );
```

### ููุชุฑุฉ ุงููุญุชูู ูู ุงูุงุณุชุนูุงูุงุช

```typescript
// ูููุณุชุฎุฏููู ุงูุนุงุฏููู
const { data: manga } = await supabase
  .from('manga')
  .select('*')
  .eq('approval_status', 'approved'); // ูุนุชูุฏุฉ ููุท

// ูููุฏุฑุงุก - ูุฑูู ูู ุงููุญุชูู
const { data: manga } = await supabase
  .from('manga')
  .select('*'); // ุฌููุน ุงูุญุงูุงุช
```

## ๐ ุงูุชุชุจุน ูุงูุฅุญุตุงุฆูุงุช

### ูุนูููุงุช ุงููุฑุงุฌุนุฉ ุงููุญููุธุฉ

```typescript
{
  approved_today: 15,        // ูุนุชูุฏ ุงูููู
  rejected_today: 3,         // ูุฑููุถ ุงูููู
  pending_manga: 8,          // ูุงูุฌุง ูุนููุฉ
  pending_chapters: 24,      // ูุตูู ูุนููุฉ
  oldest_pending_days: 5,    // ุฃูุฏู ุนูุตุฑ ูุนูู
  average_review_time: 2.5   // ูุชูุณุท ููุช ุงููุฑุงุฌุนุฉ (ุณุงุนุงุช)
}
```

### ุณุฌูุงุช ุงููุฑุงุฌุนุฉ

```sql
-- ุชุชุจุน ุฌููุน ุฅุฌุฑุงุกุงุช ุงููุฑุงุฌุนุฉ
SELECT 
  crq.title,
  crq.content_type,
  crq.status,
  crq.reviewed_by,
  crq.reviewed_at,
  crq.review_notes,
  p.display_name as reviewer_name
FROM content_review_queue crq
LEFT JOIN profiles p ON crq.reviewed_by = p.user_id
WHERE crq.reviewed_at >= NOW() - INTERVAL '7 days'
ORDER BY crq.reviewed_at DESC;
```

## ๐ ุงูุงุณุชุฎุฏุงู ุงูุนููู

### ุณููุงุฑูู ูููุฐุฌู

1. **ุงูุตุจุงุญ ุงูุจุงูุฑ (2:00 ุต):**
   - ุงููุธุงู ุงูุชููุงุฆู ูุฌูุจ ูุญุชูู ุฌุฏูุฏ
   - 5 ูุงูุฌุง ุฌุฏูุฏุฉ ู 12 ูุตู ุฌุฏูุฏ ููุถุงููู ูููุฑุงุฌุนุฉ

2. **ุงูุตุจุงุญ (9:00 ุต):**
   - ุงููุฏูุฑ ููุชุญ ููุญุฉ ุงูุฅุฏุงุฑุฉ
   - ูุฑู ุฅุดุนุงุฑ "17 ุนูุตุฑ ูุญุชุงุฌ ูุฑุงุฌุนุฉ"
   - ููุชุญ ูุงุฌูุฉ ุงููุฑุงุฌุนุฉ

3. **ุงููุฑุงุฌุนุฉ:**
   ```
   โ ูุงูุฌุง 1: ููุงููุฉ (ูุญุชูู ุฌูุฏ)
   โ ูุงูุฌุง 2: ุฑูุถ (ูุญุชูู ุบูุฑ ููุงุณุจ)
   โ ูุงูุฌุง 3: ููุงููุฉ (ุจุนุฏ ูุฑุงุฌุนุฉ ุงูุชุตูููุงุช)
   โ 12 ูุตู: ููุงููุฉ ุฌูุงุนูุฉ (ูุตูู ููุงูุฌุง ูุนุชูุฏุฉ ูุณุจูุงู)
   ```

4. **ุงููุชูุฌุฉ:**
   - 4 ูุงูุฌุง ุฌุฏูุฏุฉ ููุดูุฑุฉ ูููุณุชุฎุฏููู
   - 12 ูุตู ุฌุฏูุฏ ูุชุงุญ ูููุฑุงุกุฉ
   - 1 ูุงูุฌุง ูุฑููุถุฉ (ูุฎููุฉ)

### ูุตุงุฆุญ ูููุฑุงุฌุนุฉ ุงูุณุฑูุนุฉ

1. **ุฃููููุฉ ุงููุฑุงุฌุนุฉ:**
   - ูุงูุฌุง ุฌุฏูุฏุฉ ุฃููุงู (ุฃููููุฉ ุนุงููุฉ)
   - ูุตู๏ฟฝ๏ฟฝ ููุงูุฌุง ูุนุชูุฏุฉ ูุณุจูุงู (ุฃููููุฉ ููุฎูุถุฉ)

2. **ูุนุงููุฑ ุงูููุงููุฉ:**
   - ุฌูุฏุฉ ุงูุชุฑุฌูุฉ ูุงูุตูุฑ
   - ููุงุกูุฉ ุงููุญุชูู ููุฌูููุฑ ุงููุณุชูุฏู
   - ุตุญุฉ ุงููุนูููุงุช ูุงูุชุตูููุงุช

3. **ูุนุงููุฑ ุงูุฑูุถ:**
   - ูุญุชูู ุบูุฑ ููุงุณุจ ุฃู ูุณูุก
   - ุฌูุฏุฉ ุฑุฏูุฆุฉ ุฌุฏุงู
   - ูุฎุงููุฉ ุญููู ุงูุทุจุน ูุงููุดุฑ

## ๐ง ุงูุตูุงูุฉ ูุงูุชุญุณูู

### ุชูุธูู ุฏูุฑู
```sql
-- ุญุฐู ุณุฌูุงุช ุงููุฑุงุฌุนุฉ ุงููุฏููุฉ (ุฃูุซุฑ ูู 3 ุดููุฑ)
DELETE FROM content_review_queue 
WHERE reviewed_at < NOW() - INTERVAL '3 months';

-- ุฃุฑุดูุฉ ุงูุณุฌูุงุช ุงููููุฉ
INSERT INTO review_archive 
SELECT * FROM content_review_queue 
WHERE reviewed_at < NOW() - INTERVAL '1 month'
AND status IN ('approved', 'rejected');
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
```sql
-- ูุชูุณุท ููุช ุงููุฑุงุฌุนุฉ
SELECT 
  AVG(EXTRACT(EPOCH FROM (reviewed_at - submitted_at))/3600) as avg_hours
FROM content_review_queue 
WHERE status != 'pending';

-- ุฅุญุตุงุฆูุงุช ุงููุฑุงุฌุนูู
SELECT 
  reviewed_by,
  COUNT(*) as total_reviews,
  COUNT(CASE WHEN status = 'approved' THEN 1 END) as approved,
  COUNT(CASE WHEN status = 'rejected' THEN 1 END) as rejected
FROM content_review_queue 
WHERE reviewed_at >= NOW() - INTERVAL '1 month'
GROUP BY reviewed_by;
```

---

## ๐ ุงูุฏุนู ูุงูุชุทููุฑ

ูุฐุง ุงููุธุงู ูุตูู ููููู:
- **ุขูู:** ูุญุชูู ูุญูู ููููุชุฑ
- **ุณุฑูุน:** ูุฑุงุฌุนุฉ ูุนุงูุฉ ูุน ุฅุดุนุงุฑุงุช ููุฑูุฉ  
- **ูุฑู:** ูุงุจู ููุชุฎุตูุต ูุงูุชูุณุน
- **ุดูุงู:** ุณุฌูุงุช ููุตูุฉ ูุฌููุน ุงูุฅุฌุฑุงุกุงุช

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ูุถูุงู ุฌูุฏุฉ ุงููุญุชูู ูุน ุงูุญูุงุธ ุนูู ุงูุณุฑุนุฉ ุงูุชููุงุฆูุฉ! ๐**
